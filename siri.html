<!doctype html>
<html lang="uk">
    <head>
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta
            name="apple-mobile-web-app-status-bar-style"
            content="black-translucent"
        />
        <meta name="apple-mobile-web-app-title" content="Siri 2.0" />

        <link
            rel="apple-touch-icon"
            href="https://cdn-icons-png.flaticon.com/512/2103/2103633.png"
        />

        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
        />
        <title>AI Siri Pro</title>
        <style>
            :root {
                --bg: #0b0b0d;
                --user-bubble: #007aff;
                --ai-bubble: #1c1c1e;
                --text: #ffffff;
            }

            body {
                font-family: -apple-system, BlinkMacSystemFont, sans-serif;
                background-color: var(--bg);
                color: var(--text);
                margin: 0;
                display: flex;
                flex-direction: column;
                height: 100vh;
                overflow: hidden;
            }

            /* –®–∞–ø–∫–∞ –∑ –∫–Ω–æ–ø–∫–æ—é –∫–ª—é—á–∞ */
            header {
                padding: 15px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                background: rgba(255, 255, 255, 0.05);
                backdrop-filter: blur(10px);
            }

            .key-btn {
                background: none;
                border: 1px solid #444;
                color: #888;
                padding: 5px 10px;
                border-radius: 10px;
                font-size: 12px;
                cursor: pointer;
            }

            /* –û–±–ª–∞—Å—Ç—å —á–∞—Ç—É */
            #chat {
                flex: 1;
                overflow-y: auto;
                padding: 20px;
                display: flex;
                flex-direction: column;
                gap: 12px;
            }

            .msg {
                max-width: 80%;
                padding: 12px 16px;
                border-radius: 20px;
                font-size: 16px;
                line-height: 1.4;
                animation: slideIn 0.3s ease-out;
                word-wrap: break-word;
            }

            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .user {
                align-self: flex-end;
                background: var(--user-bubble);
            }
            .ai {
                align-self: flex-start;
                background: var(--ai-bubble);
                border: 1px solid #333;
            }

            /* –ü–æ–ª–µ –≤–≤–æ–¥—É */
            .input-area {
                padding: 15px;
                background: #1c1c1e;
                display: flex;
                gap: 10px;
                padding-bottom: env(
                    safe-area-inset-bottom
                ); /* –î–ª—è –Ω–æ–≤–∏—Ö iPhone */
            }

            input {
                flex: 1;
                background: #2c2c2e;
                border: none;
                border-radius: 20px;
                padding: 12px 15px;
                color: white;
                font-size: 16px;
                outline: none;
            }

            .send-btn {
                background: var(--user-bubble);
                border: none;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                color: white;
                font-size: 18px;
                cursor: pointer;
            }

            /* –ö—Ä–∞–ø–∫–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è */
            .dots {
                display: flex;
                gap: 4px;
                padding: 5px;
            }
            .dot {
                width: 6px;
                height: 6px;
                background: #888;
                border-radius: 50%;
                animation: blink 1.4s infinite;
            }
            .dot:nth-child(2) {
                animation-delay: 0.2s;
            }
            .dot:nth-child(3) {
                animation-delay: 0.4s;
            }
            @keyframes blink {
                0%,
                100% {
                    opacity: 0.3;
                }
                50% {
                    opacity: 1;
                }
            }
        </style>
    </head>
    <body>
        <header>
            <span>Siri 2.0</span>
            <button class="key-btn" onclick="updateKey()">üîë API KEY</button>
        </header>

        <div id="chat">
            <div class="msg ai">
                –ü—Ä–∏–≤—ñ—Ç! –Ø —Ç–≤—ñ–π —Ä–æ–∑—É–º–Ω–∏–π –∞—Å–∏—Å—Ç–µ–Ω—Ç. –Ø –º–æ–∂—É –∫–µ—Ä—É–≤–∞—Ç–∏ –ª—ñ—Ö—Ç–∞—Ä–∏–∫–æ–º,
                —è–∫—â–æ —Ç–∏ –ø–æ–ø—Ä–æ—Å–∏—à.
            </div>
        </div>

        <div class="input-area">
            <input
                type="text"
                id="userInput"
                placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..."
                autocomplete="off"
            />
            <button class="send-btn" onclick="sendMessage()">‚Üë</button>
        </div>

        <script>
            // 1. –ë–ï–ó–ü–ï–ö–ê: –û—Ç—Ä–∏–º—É—î–º–æ –∫–ª—é—á —ñ–∑ –ø–∞–º'—è—Ç—ñ –±—Ä–∞—É–∑–µ—Ä–∞
            let apiKey = localStorage.getItem("gpt_siri_key");

            if (!apiKey) {
                setupKey();
            }

            function setupKey() {
                const key = prompt(
                    "–í–≤–µ–¥—ñ—Ç—å —Å–≤—ñ–π OpenAI API Key (–≤—ñ–Ω –∑–±–µ—Ä–µ–∂–µ—Ç—å—Å—è –ª–∏—à–µ –ª–æ–∫–∞–ª—å–Ω–æ):",
                );
                if (key) {
                    localStorage.setItem("gpt_siri_key", key);
                    apiKey = key;
                    location.reload();
                }
            }

            // 2. –û–ë–†–û–ë–ö–ê –ö–õ–ê–í–Ü–ê–¢–£–†–ò (Enter –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏)
            const inputField = document.getElementById("userInput");
            inputField.addEventListener("keydown", (e) => {
                if (e.key === "Enter" && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // 3. –ì–û–õ–û–í–ù–ê –§–£–ù–ö–¶–Ü–Ø –í–Ü–î–ü–†–ê–í–ö–ò
            async function sendMessage() {
                const text = inputField.value.trim();
                if (!text || !apiKey) return;

                addMessage(text, "user"); // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ —Ç–µ–∫—Å—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                inputField.value = "";

                // –î–æ–¥–∞—î–º–æ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è
                const chat = document.getElementById("chat");
                const loadingId = "load-" + Date.now();
                const loadingDiv = document.createElement("div");
                loadingDiv.className = "msg ai";
                loadingDiv.id = loadingId;
                loadingDiv.innerHTML =
                    '<div class="dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>';
                chat.appendChild(loadingDiv);
                chat.scrollTop = chat.scrollHeight;

                try {
                    const response = await fetch(
                        "https://api.openai.com/v1/chat/completions",
                        {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                                Authorization: `Bearer ${apiKey}`,
                            },
                            body: JSON.stringify({
                                model: "gpt-4o-mini",
                                messages: [
                                    {
                                        role: "system",
                                        content: `–¢–∏ ‚Äî —Å–∏—Å—Ç–µ–º–Ω–∏–π –∞—Å–∏—Å—Ç–µ–Ω—Ç iOS. –¢–≤–æ—ó –ø—Ä–∞–≤–∏–ª–∞:
                                    1. –Ø–∫—â–æ –ø—Ä–æ—Å—è—Ç—å —É–≤—ñ–º–∫–Ω—É—Ç–∏ –ª—ñ—Ö—Ç–∞—Ä–∏–∫, –ø–∏—à–∏ —Å–ª–æ–≤–æ "–ª—ñ—Ö—Ç–∞—Ä–∏–∫".
                                    2. –Ø–∫—â–æ –ø—Ä–æ—Å—è—Ç—å –ø–æ–¥–∑–≤–æ–Ω–∏—Ç–∏, –ø–∏—à–∏: "–¢–ï–õ–ï–§–û–ù–£–Æ: [–Ω–æ–º–µ—Ä]".
                                    3. –Ø–∫—â–æ –ø—Ä–æ—Å—è—Ç—å –≤—ñ–¥–∫—Ä–∏—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º—É, –ø–∏—à–∏: "–í–Ü–î–ö–†–ò–í–ê–Æ: [Name]". –ù–∞–∑–≤—É –ø—Ä–æ–≥—Ä–∞–º–∏ –ø–∏—à–∏ –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é –º–æ–≤–æ—é.`,
                                    },
                                    { role: "user", content: text },
                                ],
                            }),
                        },
                    );

                    const data = await response.json();
                    document.getElementById(loadingId).remove();

                    if (data.choices) {
                        const aiText = data.choices[0].message.content;
                        addMessage(aiText, "ai");

                        const lowerText = aiText.toLowerCase();

                        // --- –õ–û–ì–Ü–ö–ê –¢–†–ò–ì–ï–†–Ü–í (–®–û–†–¢–ö–ê–¢–Ü–í) ---

                        // –ê) –õ–Ü–•–¢–ê–†–ò–ö
                        if (lowerText.includes("–ª—ñ—Ö—Ç–∞—Ä–∏–∫")) {
                            executeShortcut("Torch");
                        }

                        // –ë) –î–ó–í–Ü–ù–û–ö
                        if (aiText.includes("–¢–ï–õ–ï–§–û–ù–£–Æ:")) {
                            const phoneNumber =
                                aiText.match(/\+?\d[\d\s-]{7,}\d/g);
                            if (phoneNumber) {
                                const cleanNumber = phoneNumber[0].replace(
                                    /\s/g,
                                    "",
                                );
                                executeShortcut("CallContact", cleanNumber);
                            }
                        }

                        // –í) –í–Ü–î–ö–†–ò–¢–¢–Ø –ü–†–û–ì–†–ê–ú
                        if (aiText.includes("–í–Ü–î–ö–†–ò–í–ê–Æ:")) {
                            const appName = aiText
                                .split("–í–Ü–î–ö–†–ò–í–ê–Æ:")[1]
                                .trim();
                            executeShortcut("OpenApp", appName);
                        }
                    } else {
                        addMessage(
                            "–ü–æ–º–∏–ª–∫–∞ API. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–ª—é—á –∞–±–æ –±–∞–ª–∞–Ω—Å.",
                            "ai",
                        );
                    }
                } catch (e) {
                    if (document.getElementById(loadingId))
                        document.getElementById(loadingId).remove();
                    addMessage("–ü–æ–º–∏–ª–∫–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º.", "ai");
                }
            }

            // 4. –î–û–ü–û–ú–Ü–ñ–ù–Ü –§–£–ù–ö–¶–Ü–á
            function addMessage(text, type) {
                const chat = document.getElementById("chat");
                const div = document.createElement("div");
                div.className = `msg ${type}`;
                div.textContent = text;
                chat.appendChild(div);
                chat.scrollTop = chat.scrollHeight;
            }

            function executeShortcut(name, input = "") {
                setTimeout(() => {
                    let url = `shortcuts://run-shortcut?name=${name}`;
                    if (input) url += `&input=${encodeURIComponent(input)}`;
                    window.location.href = url;
                }, 1000); // –ù–µ–≤–µ–ª–∏–∫–∞ –∑–∞—Ç—Ä–∏–º–∫–∞, —â–æ–± –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—Å—Ç–∏–≥ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å
            }
        </script>
    </body>
</html>
