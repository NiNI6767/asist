<!doctype html>
<html lang="uk">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
        />
        <title>AI Siri Pro</title>
        <style>
            :root {
                --bg: #0b0b0d;
                --user-bubble: #007aff;
                --ai-bubble: #1c1c1e;
                --text: #ffffff;
            }

            body {
                font-family: -apple-system, BlinkMacSystemFont, sans-serif;
                background-color: var(--bg);
                color: var(--text);
                margin: 0;
                display: flex;
                flex-direction: column;
                height: 100vh;
                overflow: hidden;
            }

            /* –®–∞–ø–∫–∞ –∑ –∫–Ω–æ–ø–∫–æ—é –∫–ª—é—á–∞ */
            header {
                padding: 15px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                background: rgba(255, 255, 255, 0.05);
                backdrop-filter: blur(10px);
            }

            .key-btn {
                background: none;
                border: 1px solid #444;
                color: #888;
                padding: 5px 10px;
                border-radius: 10px;
                font-size: 12px;
                cursor: pointer;
            }

            /* –û–±–ª–∞—Å—Ç—å —á–∞—Ç—É */
            #chat {
                flex: 1;
                overflow-y: auto;
                padding: 20px;
                display: flex;
                flex-direction: column;
                gap: 12px;
            }

            .msg {
                max-width: 80%;
                padding: 12px 16px;
                border-radius: 20px;
                font-size: 16px;
                line-height: 1.4;
                animation: slideIn 0.3s ease-out;
                word-wrap: break-word;
            }

            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .user {
                align-self: flex-end;
                background: var(--user-bubble);
            }
            .ai {
                align-self: flex-start;
                background: var(--ai-bubble);
                border: 1px solid #333;
            }

            /* –ü–æ–ª–µ –≤–≤–æ–¥—É */
            .input-area {
                padding: 15px;
                background: #1c1c1e;
                display: flex;
                gap: 10px;
                padding-bottom: env(
                    safe-area-inset-bottom
                ); /* –î–ª—è –Ω–æ–≤–∏—Ö iPhone */
            }

            input {
                flex: 1;
                background: #2c2c2e;
                border: none;
                border-radius: 20px;
                padding: 12px 15px;
                color: white;
                font-size: 16px;
                outline: none;
            }

            .send-btn {
                background: var(--user-bubble);
                border: none;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                color: white;
                font-size: 18px;
                cursor: pointer;
            }

            /* –ö—Ä–∞–ø–∫–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è */
            .dots {
                display: flex;
                gap: 4px;
                padding: 5px;
            }
            .dot {
                width: 6px;
                height: 6px;
                background: #888;
                border-radius: 50%;
                animation: blink 1.4s infinite;
            }
            .dot:nth-child(2) {
                animation-delay: 0.2s;
            }
            .dot:nth-child(3) {
                animation-delay: 0.4s;
            }
            @keyframes blink {
                0%,
                100% {
                    opacity: 0.3;
                }
                50% {
                    opacity: 1;
                }
            }
        </style>
    </head>
    <body>
        <header>
            <span>Siri 2.0</span>
            <button class="key-btn" onclick="updateKey()">üîë API KEY</button>
        </header>

        <div id="chat">
            <div class="msg ai">
                –ü—Ä–∏–≤—ñ—Ç! –Ø —Ç–≤—ñ–π —Ä–æ–∑—É–º–Ω–∏–π –∞—Å–∏—Å—Ç–µ–Ω—Ç. –Ø –º–æ–∂—É –∫–µ—Ä—É–≤–∞—Ç–∏ –ª—ñ—Ö—Ç–∞—Ä–∏–∫–æ–º,
                —è–∫—â–æ —Ç–∏ –ø–æ–ø—Ä–æ—Å–∏—à.
            </div>
        </div>

        <div class="input-area">
            <input
                type="text"
                id="userInput"
                placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..."
                autocomplete="off"
            />
            <button class="send-btn" onclick="sendMessage()">‚Üë</button>
        </div>

        <script>
            let apiKey = localStorage.getItem("gpt_siri_key");

            // –§—É–Ω–∫—Ü—ñ—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–ª—é—á–∞
            function updateKey() {
                const key = prompt("–í–≤–µ–¥—ñ—Ç—å –≤–∞—à OpenAI API Key:");
                if (key) {
                    localStorage.setItem("gpt_siri_key", key);
                    apiKey = key;
                    location.reload();
                }
            }

            // –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ Enter
            document
                .getElementById("userInput")
                .addEventListener("keypress", (e) => {
                    if (e.key === "Enter") sendMessage();
                });

            async function sendMessage() {
                const input = document.getElementById("userInput");
                const text = input.value.trim();

                if (!text) return;
                if (!apiKey) {
                    updateKey();
                    return;
                }

                addMessage(text, "user");
                input.value = "";

                // –î–æ–¥–∞—î–º–æ –∞–Ω—ñ–º–∞—Ü—ñ—é –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è
                const loadingId = "load-" + Date.now();
                const loadingDiv = document.createElement("div");
                loadingDiv.className = "msg ai";
                loadingDiv.id = loadingId;
                loadingDiv.innerHTML =
                    '<div class="dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>';
                document.getElementById("chat").appendChild(loadingDiv);

                try {
                    const response = await fetch(
                        "https://api.openai.com/v1/chat/completions",
                        {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                                Authorization: `Bearer ${apiKey}`,
                            },
                            body: JSON.stringify({
                                model: "gpt-4o-mini",
                                messages: [
                                    {
                                        role: "system",
                                        content:
                                            '–¢–∏ –∞—Å–∏—Å—Ç–µ–Ω—Ç, —â–æ –∫–µ—Ä—É—î iPhone. –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ö–æ—á–µ —É–≤—ñ–º–∫–Ω—É—Ç–∏ –∞–±–æ –≤–∏–º–∫–Ω—É—Ç–∏ –ª—ñ—Ö—Ç–∞—Ä–∏–∫, –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π —Å–ª–æ–≤–æ "–ª—ñ—Ö—Ç–∞—Ä–∏–∫" —É –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ.',
                                    },
                                    { role: "user", content: text },
                                ],
                            }),
                        },
                    );

                    const data = await response.json();
                    document.getElementById(loadingId).remove();

                    if (data.choices) {
                        const aiText = data.choices[0].message.content;
                        addMessage(aiText, "ai");

                        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –ª—ñ—Ö—Ç–∞—Ä–∏–∫
                        if (aiText.toLowerCase().includes("–ª—ñ—Ö—Ç–∞—Ä–∏–∫")) {
                            setTimeout(() => {
                                window.location.href =
                                    "shortcuts://run-shortcut?name=Torch";
                            }, 500);
                        }
                    } else {
                        addMessage(
                            "–ü–æ–º–∏–ª–∫–∞ API. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–ª—é—á –∞–±–æ –±–∞–ª–∞–Ω—Å.",
                            "ai",
                        );
                    }
                } catch (e) {
                    document.getElementById(loadingId).remove();
                    addMessage("–ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ.", "ai");
                }
            }

            function addMessage(text, type) {
                const chat = document.getElementById("chat");
                const div = document.createElement("div");
                div.className = `msg ${type}`;
                div.textContent = text;
                chat.appendChild(div);
                chat.scrollTop = chat.scrollHeight;
            }
        </script>
    </body>
</html>
