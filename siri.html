<!doctype html>
<html lang="uk">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Siri 2.0 Secure</title>
        <style>
            :root {
                --bg: #0f0f12;
                --user: #007aff;
                --ai: #242429;
            }
            body {
                font-family: -apple-system, sans-serif;
                background: var(--bg);
                color: white;
                margin: 0;
                display: flex;
                flex-direction: column;
                height: 100vh;
            }
            #chat {
                flex: 1;
                overflow-y: auto;
                padding: 20px;
                display: flex;
                flex-direction: column;
                gap: 15px;
            }
            .msg {
                max-width: 85%;
                padding: 14px;
                border-radius: 20px;
                animation: fadeIn 0.3s ease;
            }
            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            .user {
                align-self: flex-end;
                background: var(--user);
            }
            .ai {
                align-self: flex-start;
                background: var(--ai);
                border: 1px solid #333;
            }
            .input-box {
                padding: 20px;
                background: rgba(30, 30, 35, 0.9);
                display: flex;
                gap: 10px;
                backdrop-filter: blur(10px);
                border-top: 1px solid #333;
            }
            input {
                flex: 1;
                padding: 12px;
                border-radius: 20px;
                border: 1px solid #444;
                background: #1a1a1e;
                color: white;
                outline: none;
            }
            button {
                background: var(--user);
                color: white;
                border: none;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                cursor: pointer;
            }
            #key-manager {
                position: fixed;
                top: 10px;
                right: 10px;
                font-size: 10px;
                color: #555;
                cursor: pointer;
            }
        </style>
    </head>
    <body>
        <div id="key-manager" onclick="setupKey()">üîë –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∫–ª—é—á</div>
        <div id="chat"></div>

        <div class="input-box">
            <input type="text" id="userInput" placeholder="–ó–∞–ø–∏—Ç–∞–π —â–æ—Å—å..." />
            <button onclick="sendMessage()">üöÄ</button>
        </div>

        <script>
            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–ª—é—á–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
            let apiKey = localStorage.getItem("openai_key");

            if (!apiKey) {
                setupKey();
            }

            function setupKey() {
                const key = prompt(
                    "–í–≤–µ–¥–∏ —Å–≤—ñ–π OpenAI API Key (–≤—ñ–Ω –∑–±–µ—Ä–µ–∂–µ—Ç—å—Å—è –ª–∏—à–µ —É —Ç–µ–±–µ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—ñ):",
                );
                if (key) {
                    localStorage.setItem("openai_key", key);
                    apiKey = key;
                    alert("–ö–ª—é—á –∑–±–µ—Ä–µ–∂–µ–Ω–æ!");
                }
            }

            async function sendMessage() {
                const input = document.getElementById("userInput");
                const chat = document.getElementById("chat");
                const text = input.value.trim();

                if (!text || !apiKey) return;

                addMessage(text, "user");
                input.value = "";

                // –¢–æ—á–∫–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
                const loading = document.createElement("div");
                loading.className = "msg ai";
                loading.innerText = "...";
                chat.appendChild(loading);

                try {
                    const response = await fetch(
                        "https://api.openai.com/v1/chat/completions",
                        {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                                Authorization: `Bearer ${apiKey}`,
                            },
                            body: JSON.stringify({
                                model: "gpt-4o-mini",
                                messages: [
                                    {
                                        role: "system",
                                        content:
                                            '–¢–∏ —Ä–æ–∑—É–º–Ω–∏–π –∞—Å–∏—Å—Ç–µ–Ω—Ç. –Ø–∫—â–æ –ø—Ä–æ—Å—è—Ç—å –ª—ñ—Ö—Ç–∞—Ä–∏–∫, –ø–∏—à–∏ "–≤–º–∏–∫–∞—é –ª—ñ—Ö—Ç–∞—Ä–∏–∫".',
                                    },
                                    { role: "user", content: text },
                                ],
                            }),
                        },
                    );

                    const data = await response.json();
                    chat.removeChild(loading);

                    if (data.choices) {
                        const aiText = data.choices[0].message.content;
                        addMessage(aiText, "ai");

                        // –õ–æ–≥—ñ–∫–∞ –ª—ñ—Ö—Ç–∞—Ä–∏–∫–∞
                        if (aiText.toLowerCase().includes("–ª—ñ—Ö—Ç–∞—Ä–∏–∫")) {
                            window.location.href =
                                "shortcuts://run-shortcut?name=Torch";
                        }
                    } else {
                        addMessage(
                            "–ü–æ–º–∏–ª–∫–∞! –ü–µ—Ä–µ–≤—ñ—Ä –∫–ª—é—á (–Ω–∞—Ç–∏—Å–Ω–∏ –∫–Ω–æ–ø–∫—É üîë –≤–≥–æ—Ä—ñ).",
                            "ai",
                        );
                    }
                } catch (e) {
                    addMessage("–ü–æ–º–∏–ª–∫–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è.", "ai");
                }
            }

            function addMessage(text, type) {
                const chat = document.getElementById("chat");
                const div = document.createElement("div");
                div.className = `msg ${type}`;
                div.textContent = text;
                chat.appendChild(div);
                chat.scrollTop = chat.scrollHeight;
            }
            // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –ø–æ–ª–µ –≤–≤–æ–¥—É
            const userInput = document.getElementById("userInput");

            // –î–æ–¥–∞—î–º–æ —Å–ª—É—Ö–∞—á –ø–æ–¥—ñ–π –¥–ª—è –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏
            userInput.addEventListener("keydown", function (event) {
                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –Ω–∞—Ç–∏—Å–Ω—É—Ç–æ Enter –ë–ï–ó –∫–ª–∞–≤—ñ—à—ñ Shift
                if (event.key === "Enter" && !event.shiftKey) {
                    event.preventDefault(); // –ó–∞–±–æ—Ä–æ–Ω—è—î–º–æ –ø–µ—Ä–µ–Ω–æ—Å —Ä—è–¥–∫–∞
                    sendMessage(); // –í–∏–∫–ª–∏–∫–∞—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é –≤—ñ–¥–ø—Ä–∞–≤–∫–∏
                }
            });
        </script>
    </body>
</html>
